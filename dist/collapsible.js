/**
 * Collapse navbar items dynamically, when there isn't enough space on the screen.
 *
 * @param {String} selector The selector for the items' container
 * @param {Number} threshold The minimum available space in the container
 */
class Collapsible {
  constructor(selector, threshold) {
    this.container = this.queryContainer(selector);
    this.threshold = threshold;
    this.items = this.container.querySelectorAll('li');
    this.itemsDimensions = this.getItemsDimensions();
  }
  /**
   * Given the selector, query the items' container.
   * If it is unreachable, an exception is throwed.
   * 
   * @param {String} selector
   * @returns {*} The items' container element
   */


  queryContainer(selector) {
    const container = document.querySelector(selector);

    if (!container) {
      throw new Error('Collapsible: No element find using "' + selector + '" selector');
    }

    return container;
  }
  /**
   * Get initial dimensions for each item, in order to approximate
   * the space necessary to render them all.
   */


  getItemsDimensions() {
    const dimensions = [];

    for (let i = 0; i < this.items.length; i++) {
      const item = this.items[i];
      const width = item.getBoundingClientRect().width;
      dimensions.push(width);
    }

    return dimensions;
  }
  /**
   * Calculate the available space based on the page width, and return
   * the amount of items we must collapse.
   * 
   * @returns {Number} Amount of items to collapse
   */


  getAmountOfItemsToCollapse() {
    const renderable = {
      amount: 0,
      width: 0
    };
    const pageWidth = document.body.offsetWidth;

    for (let i = 0; i < this.items.length; i++) {
      const itemWidth = this.itemsDimensions[i];
      renderable.width += itemWidth;
      if (pageWidth - renderable.width < this.threshold) break;
      renderable.amount++;
    }

    return this.items.length - renderable.amount;
  }

  collapse() {
    const menu = this.container.querySelector('.collapsible-menu');
    const dropdown = menu.querySelector('.collapsible-dropdown');
    const dropdownItems = dropdown.querySelectorAll('li');
    const amountOfItemsToCollapse = this.getAmountOfItemsToCollapse(); // Default case on large screens and when there is enough space

    menu.classList.remove('hide');

    if (amountOfItemsToCollapse === 0) {
      menu.classList.add('hide');
    } // Clear the state for each item: both in the original list and in the collapsed one


    this.items.forEach((item, index) => {
      const clone = dropdownItems[index];
      item.classList.remove('hide');
      clone.classList.add('hide');
    });

    for (let i = 0; i < amountOfItemsToCollapse; i++) {
      const index = dropdownItems.length - i - 1;
      const item = this.items[index];
      const clone = dropdownItems[index];
      item.classList.add('hide');
      clone.classList.remove('hide');
    }
  }
  /**
   * Inject the collapsed menu which will contain the exceeding items.
   * The default content is meant to act like a placeholder.
   * You should customize this method based on your needs.
   */


  inject() {
    const menu = document.createElement('li');
    menu.classList.add('collapsible-menu');
    const dropdownList = document.createElement('ul');
    dropdownList.classList.add('dropdown-menu', 'collapsible-dropdown-list');
    const icon = document.createElement('span');
    icon.classList.add('fas', 'fa-bars');
    const dropdown = document.createElement('div');
    dropdown.classList.add('dropdown', 'collapsible-dropdown');
    const button = document.createElement('button');
    button.classList.add('btn', 'dropdown-toggle', 'collapsible-toggle'); // Attach event to toggle dropdown menu, without using default Bootstrap jQuery-based script

    button.addEventListener('click', ev => {
      ev.preventDefault();
      dropdown.classList.toggle('open');
    }); // Copy items from the original navbar

    this.items.forEach(item => {
      const clone = item.cloneNode(true);
      clone.classList.add('hide');
      dropdownList.append(clone);
    });
    button.append(icon);
    dropdown.append(button);
    dropdown.append(dropdownList);
    menu.append(dropdown);
    this.container.append(menu);
  }
  /**
   * Initialize the resize sensor and assign it the right callback,
   * containing the code to collapse exceeding items when necessary.
   */


  render() {
    this.inject();
    this.collapse();
    new ResizeSensor(this.container, this.collapse.bind(this));
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbGxhcHNpYmxlLmpzIl0sIm5hbWVzIjpbIkNvbGxhcHNpYmxlIiwiY29uc3RydWN0b3IiLCJzZWxlY3RvciIsInRocmVzaG9sZCIsImNvbnRhaW5lciIsInF1ZXJ5Q29udGFpbmVyIiwiaXRlbXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaXRlbXNEaW1lbnNpb25zIiwiZ2V0SXRlbXNEaW1lbnNpb25zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiRXJyb3IiLCJkaW1lbnNpb25zIiwiaSIsImxlbmd0aCIsIml0ZW0iLCJ3aWR0aCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInB1c2giLCJnZXRBbW91bnRPZkl0ZW1zVG9Db2xsYXBzZSIsInJlbmRlcmFibGUiLCJhbW91bnQiLCJwYWdlV2lkdGgiLCJib2R5Iiwib2Zmc2V0V2lkdGgiLCJpdGVtV2lkdGgiLCJjb2xsYXBzZSIsIm1lbnUiLCJkcm9wZG93biIsImRyb3Bkb3duSXRlbXMiLCJhbW91bnRPZkl0ZW1zVG9Db2xsYXBzZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsImZvckVhY2giLCJpbmRleCIsImNsb25lIiwiaW5qZWN0IiwiY3JlYXRlRWxlbWVudCIsImRyb3Bkb3duTGlzdCIsImljb24iLCJidXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiZXYiLCJwcmV2ZW50RGVmYXVsdCIsInRvZ2dsZSIsImNsb25lTm9kZSIsImFwcGVuZCIsInJlbmRlciIsIlJlc2l6ZVNlbnNvciIsImJpbmQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFNQSxNQUFNQSxXQUFOLENBQWtCO0FBQ2RDLEVBQUFBLFdBQVcsQ0FBQ0MsUUFBRCxFQUFXQyxTQUFYLEVBQXNCO0FBQzdCLFNBQUtDLFNBQUwsR0FBaUIsS0FBS0MsY0FBTCxDQUFvQkgsUUFBcEIsQ0FBakI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCQSxTQUFqQjtBQUVBLFNBQUtHLEtBQUwsR0FBYSxLQUFLRixTQUFMLENBQWVHLGdCQUFmLENB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LENBQUNWLFNBQVAsQ0FBaUJFLEdBQWpCLENBQXFCLEtBQXJCLEVBQTRCLGlCQUE1QixFQUErQyxvQkFBL0MsRUFkSyxDQWdCTDs7QUFDQVEsSUFBQUEsTUFBTSxDQUFDQyxnQkFBUCxDQUF3QixPQUF4QixFQUFrQ0MsRUFBRCxJQUFRO0FBQ3JDQSxNQUFBQSxFQUFFLENBQUNDLGNBQUg7QUFDQWhCLE1BQUFBLFFBQVEsQ0FBQ0csU0FBVCxDQUFtQmMsTUFBbkIsQ0FBMEIsTUFBMUI7QUFDSCxLQUhELEVBakJLLENBc0JMOztBQUNBLFNBQUt4QyxLQUFMLENBQVc2QixPQUFYLENBQW9CbkIsSUFBRCxJQUFVO0FBQ3pCLFlBQU1xQixLQUFLLEdBQUdyQixJQUFJLENBQUMrQixTQUFMLENBQWUsSUFBZixDQUFkO0FBRUFWLE1BQUFBLEtBQUssQ0FBQ0wsU0FBTixDQUFnQkUsR0FBaEIsQ0FBb0IsTUFBcEI7QUFDQU0sTUFBQUEsWUFBWSxDQUFDUSxNQUFiLENBQW9CWCxLQUFwQjtBQUNILEtBTEQ7QUFPQUssSUFBQUEsTUFBTSxDQUFDTSxNQUFQLENBQWNQLElBQWQ7QUFDQVosSUFBQUEsUUFBUSxDQUFDbUIsTUFBVCxDQUFnQk4sTUFBaEI7QUFDQWIsSUFBQUEsUUFBUSxDQUFDbUIsTUFBVCxDQUFnQlIsWUFBaEI7QUFFQVosSUFBQUEsSUFBSSxDQUFDb0IsTUFBTCxDQUFZbkIsUUFBWjtBQUNBLFNBQUt6QixTQUFMLENBQWU0QyxNQUFmLENBQXNCcEIsSUFBdEI7QUFDSDtBQUVEOzs7Ozs7QUFJQXFCLEVBQUFBLE1BQU0sR0FBRztBQUNMLFNBQUtYLE1BQUw7QUFDQSxTQUFLWCxRQUFMO0FBQ0EsUUFBSXVCLFlBQUosQ0FBaUIsS0FBSzlDLFNBQXRCLEVBQWlDLEtBQUt1QixRQUFMLENBQWN3QixJQUFkLENBQW1CLElBQW5CLENBQWpDO0FBQ0g7O0FBcEphIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb2xsYXBzZSBuYXZiYXIgaXRlbXMgZHluYW1pY2FsbHksIHdoZW4gdGhlcmUgaXNuJ3QgZW5vdWdoIHNwYWNlIG9uIHRoZSBzY3JlZW4uXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIFRoZSBzZWxlY3RvciBmb3IgdGhlIGl0ZW1zJyBjb250YWluZXJcbiAqIEBwYXJhbSB7TnVtYmVyfSB0aHJlc2hvbGQgVGhlIG1pbmltdW0gYXZhaWxhYmxlIHNwYWNlIGluIHRoZSBjb250YWluZXJcbiAqL1xuY2xhc3MgQ29sbGFwc2libGUge1xuICAgIGNvbnN0cnVjdG9yKHNlbGVjdG9yLCB0aHJlc2hvbGQpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSB0aGlzLnF1ZXJ5Q29udGFpbmVyKHNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy50aHJlc2hvbGQgPSB0aHJlc2hvbGQ7XG5cbiAgICAgICAgdGhpcy5pdGVtcyA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJyk7XG4gICAgICAgIHRoaXMuaXRlbXNEaW1lbnNpb25zID0gdGhpcy5nZXRJdGVtc0RpbWVuc2lvbnMoKTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogR2l2ZW4gdGhlIHNlbGVjdG9yLCBxdWVyeSB0aGUgaXRlbXMnIGNvbnRhaW5lci5cbiAgICAgKiBJZiBpdCBpcyB1bnJlYWNoYWJsZSwgYW4gZXhjZXB0aW9uIGlzIHRocm93ZWQuXG4gICAgICogXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yXG4gICAgICogQHJldHVybnMgeyp9IFRoZSBpdGVtcycgY29udGFpbmVyIGVsZW1lbnRcbiAgICAgKi9cbiAgICBxdWVyeUNvbnRhaW5lcihzZWxlY3Rvcikge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICBcbiAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29sbGFwc2libGU6IE5vIGVsZW1lbnQgZmluZCB1c2luZyBcIicgKyBzZWxlY3RvciArICdcIiBzZWxlY3RvcicpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGluaXRpYWwgZGltZW5zaW9ucyBmb3IgZWFjaCBpdGVtLCBpbiBvcmRlciB0byBhcHByb3hpbWF0ZVxuICAgICAqIHRoZSBzcGFjZSBuZWNlc3NhcnkgdG8gcmVuZGVyIHRoZW0gYWxsLlxuICAgICAqL1xuICAgIGdldEl0ZW1zRGltZW5zaW9ucygpIHtcbiAgICAgICAgY29uc3QgZGltZW5zaW9ucyA9IFtdO1xuICAgIFxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gID0gdGhpcy5pdGVtc1tpXTtcbiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gaXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICBcbiAgICAgICAgICAgIGRpbWVuc2lvbnMucHVzaCh3aWR0aCk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgcmV0dXJuIGRpbWVuc2lvbnM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIHRoZSBhdmFpbGFibGUgc3BhY2UgYmFzZWQgb24gdGhlIHBhZ2Ugd2lkdGgsIGFuZCByZXR1cm5cbiAgICAgKiB0aGUgYW1vdW50IG9mIGl0ZW1zIHdlIG11c3QgY29sbGFwc2UuXG4gICAgICogXG4gICAgICogQHJldHVybnMge051bWJlcn0gQW1vdW50IG9mIGl0ZW1zIHRvIGNvbGxhcHNlXG4gICAgICovXG4gICAgZ2V0QW1vdW50T2ZJdGVtc1RvQ29sbGFwc2UoKSB7XG4gICAgICAgIGNvbnN0IHJlbmRlcmFibGUgPSB7IGFtb3VudDogMCwgd2lkdGg6IDAgfTtcbiAgICAgICAgY29uc3QgcGFnZVdpZHRoID0gZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1XaWR0aCA9IHRoaXMuaXRlbXNEaW1lbnNpb25zW2ldO1xuICAgICAgICAgICAgcmVuZGVyYWJsZS53aWR0aCArPSBpdGVtV2lkdGg7XG5cbiAgICAgICAgICAgIGlmICgocGFnZVdpZHRoIC0gcmVuZGVyYWJsZS53aWR0aCkgPCB0aGlzLnRocmVzaG9sZClcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgcmVuZGVyYWJsZS5hbW91bnQrKztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1zLmxlbmd0aCAtIHJlbmRlcmFibGUuYW1vdW50O1xuICAgIH1cblxuICAgIGNvbGxhcHNlKCkge1xuICAgICAgICBjb25zdCBtZW51ID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLmNvbGxhcHNpYmxlLW1lbnUnKTtcbiAgICAgICAgY29uc3QgZHJvcGRvd24gPSBtZW51LnF1ZXJ5U2VsZWN0b3IoJy5jb2xsYXBzaWJsZS1kcm9wZG93bicpO1xuICAgICAgICBjb25zdCBkcm9wZG93bkl0ZW1zID0gZHJvcGRvd24ucXVlcnlTZWxlY3RvckFsbCgnbGknKTtcbiAgICAgICAgY29uc3QgYW1vdW50T2ZJdGVtc1RvQ29sbGFwc2UgPSB0aGlzLmdldEFtb3VudE9mSXRlbXNUb0NvbGxhcHNlKCk7XG5cbiAgICAgICAgLy8gRGVmYXVsdCBjYXNlIG9uIGxhcmdlIHNjcmVlbnMgYW5kIHdoZW4gdGhlcmUgaXMgZW5vdWdoIHNwYWNlXG4gICAgICAgIG1lbnUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGFtb3VudE9mSXRlbXNUb0NvbGxhcHNlID09PSAwKSB7XG4gICAgICAgICAgbWVudS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDbGVhciB0aGUgc3RhdGUgZm9yIGVhY2ggaXRlbTogYm90aCBpbiB0aGUgb3JpZ2luYWwgbGlzdCBhbmQgaW4gdGhlIGNvbGxhcHNlZCBvbmVcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xvbmUgPSBkcm9wZG93bkl0ZW1zW2luZGV4XTtcblxuICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgICAgICBjbG9uZS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYW1vdW50T2ZJdGVtc1RvQ29sbGFwc2U7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBkcm9wZG93bkl0ZW1zLmxlbmd0aCAtIGkgLSAxO1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbXNbaW5kZXhdO1xuICAgICAgICAgICAgY29uc3QgY2xvbmUgPSBkcm9wZG93bkl0ZW1zW2luZGV4XTtcblxuICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgICAgICBjbG9uZS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbmplY3QgdGhlIGNvbGxhcHNlZCBtZW51IHdoaWNoIHdpbGwgY29udGFpbiB0aGUgZXhjZWVkaW5nIGl0ZW1zLlxuICAgICAqIFRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgbWVhbnQgdG8gYWN0IGxpa2UgYSBwbGFjZWhvbGRlci5cbiAgICAgKiBZb3Ugc2hvdWxkIGN1c3RvbWl6ZSB0aGlzIG1ldGhvZCBiYXNlZCBvbiB5b3VyIG5lZWRzLlxuICAgICAqL1xuICAgIGluamVjdCgpIHtcbiAgICAgICAgY29uc3QgbWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgIG1lbnUuY2xhc3NMaXN0LmFkZCgnY29sbGFwc2libGUtbWVudScpO1xuXG4gICAgICAgIGNvbnN0IGRyb3Bkb3duTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG4gICAgICAgIGRyb3Bkb3duTGlzdC5jbGFzc0xpc3QuYWRkKCdkcm9wZG93bi1tZW51JywgJ2NvbGxhcHNpYmxlLWRyb3Bkb3duLWxpc3QnKTtcblxuICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhcycsICdmYS1iYXJzJyk7XG5cbiAgICAgICAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZHJvcGRvd24uY2xhc3NMaXN0LmFkZCgnZHJvcGRvd24nLCAnY29sbGFwc2libGUtZHJvcGRvd24nKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBidXR0b24uY2xhc3NMaXN0LmFkZCgnYnRuJywgJ2Ryb3Bkb3duLXRvZ2dsZScsICdjb2xsYXBzaWJsZS10b2dnbGUnKTtcblxuICAgICAgICAvLyBBdHRhY2ggZXZlbnQgdG8gdG9nZ2xlIGRyb3Bkb3duIG1lbnUsIHdpdGhvdXQgdXNpbmcgZGVmYXVsdCBCb290c3RyYXAgalF1ZXJ5LWJhc2VkIHNjcmlwdFxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpID0+IHtcbiAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBkcm9wZG93bi5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENvcHkgaXRlbXMgZnJvbSB0aGUgb3JpZ2luYWwgbmF2YmFyXG4gICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xvbmUgPSBpdGVtLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICAgICAgY2xvbmUuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgICAgICAgZHJvcGRvd25MaXN0LmFwcGVuZChjbG9uZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGJ1dHRvbi5hcHBlbmQoaWNvbik7XG4gICAgICAgIGRyb3Bkb3duLmFwcGVuZChidXR0b24pO1xuICAgICAgICBkcm9wZG93bi5hcHBlbmQoZHJvcGRvd25MaXN0KTtcblxuICAgICAgICBtZW51LmFwcGVuZChkcm9wZG93bik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZChtZW51KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSByZXNpemUgc2Vuc29yIGFuZCBhc3NpZ24gaXQgdGhlIHJpZ2h0IGNhbGxiYWNrLFxuICAgICAqIGNvbnRhaW5pbmcgdGhlIGNvZGUgdG8gY29sbGFwc2UgZXhjZWVkaW5nIGl0ZW1zIHdoZW4gbmVjZXNzYXJ5LlxuICAgICAqL1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5pbmplY3QoKTtcbiAgICAgICAgdGhpcy5jb2xsYXBzZSgpO1xuICAgICAgICBuZXcgUmVzaXplU2Vuc29yKHRoaXMuY29udGFpbmVyLCB0aGlzLmNvbGxhcHNlLmJpbmQodGhpcykpO1xuICAgIH1cbn1cbiJdLCJmaWxlIjoiY29sbGFwc2libGUuanMifQ==